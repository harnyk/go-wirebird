version: '3'

tasks:
  
  dev:
    cmds:
      - task: generate_ts
      - task: generate_schema

  serve:
    cmds:
      - go run ./cmd/server
    deps:
      - build_webui
      - copy_html
  
  build_webui:
    cmds:
      - yarn build
    sources:
      - ./internal/webui/**/*.*
    generates:
      - ./internal/router/dist/index.html
      - ./internal/router/dist/bundle.js
      - ./internal/router/dist/bundle.css
  
  copy_html:
    cmds:
      - cp ./internal/webui/index.html ./internal/router/dist/index.html
    sources:
      - ./internal/webui/index.html
    generates:
      - ./internal/router/dist/index.html

  test:
    cmds:
      - go test -v ./...

  generate_ts:
    cmds:
      - go run ./cmd/gents -o internal/generated/types.ts
    sources:
      - internal/models/*.go
    generates:
      - internal/generated/types.ts


  generate_schema:
    cmds:
      - go run ./cmd/genschemas -o internal/generated/LoggerEvent.schema.json
    sources:
      - internal/models/*.go
    generates:
      - internal/generated/LoggerEvent.schema.json

